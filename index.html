<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>カナラッド</title>
    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="shortcut icon" href="/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <meta name="apple-mobile-web-app-title" content="カナラッド" />
    <link rel="manifest" href="/site.webmanifest" />
    <style>
        @import 'https://fonts.googleapis.com/css?family=Open+Sans';
        * {
            -webkit-box-sizing: border-box;
            box-sizing: border-box;
        }
        body {
            font-family: 'Open Sans', sans-serif;
            line-height: 1.75em;
            font-size: 16px;
            background-color: #222;
            color: #aaa;
        }

        .simple-container {
            max-width: 675px;
            margin: 0 auto;
            padding-top: 70px;
            padding-bottom: 20px;
        }

        .simple-print {
            fill: white;
            stroke: white;
        }
        .simple-print svg {
            height: 100%;
        }

        .simple-close {
            color: white;
            border-color: white;
        }

        .simple-ext-info {
            border-top: 1px solid #aaa;
        }

        p {
            font-size: 16px;
        }

        h1 {
            font-size: 30px;
            line-height: 34px;
        }

        h2 {
            font-size: 20px;
            line-height: 25px;
        }

        h3 {
            font-size: 16px;
            line-height: 27px;
            padding-top: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #D8D8D8;
            border-top: 1px solid #D8D8D8;
        }

        hr {
            height: 1px;
            background-color: #d8d8d8;
            border: none;
            width: 100%;
            margin: 0px;
        }

        a[href] {
            color: #1e8ad6;
        }

        a[href]:hover {
            color: #3ba0e6;
        }

        img {
            max-width: 100%;
        }

        li {
            line-height: 1.5em;
        }

        aside,
        [class *= "sidebar"],
        [id *= "sidebar"] {
            max-width: 90%;
            margin: 0 auto;
            border: 1px solid lightgrey;
            padding: 5px 15px;
        }

        @media (min-width: 1921px) {
            body {
                font-size: 18px;
            }
        }
    </style>
</head>
<body>
    <div id="controls">
        <a href="#" onclick="load_deck('');">Home</a>
        <button type="button" onclick="set_questions(get_question_choice());">Reset</button>
        <button type="button" onclick="next_question();">Skip</button>
        <input type="checkbox" id="hint-toggle" onclick="toggle_hint_setting();">
    </div>

    <div id="q-and-a">
        <h1 id="question" onclick="temporarily_show_hide_hint();"></h1>
        <p id="hint"></p>
        <div id="answer-container">
            <input type="text" id="answer" onkeyup="check_answer();">
        </div>
    </div>
    <div id="question-sets">
        <ul>
            <li><a href="#n5_vocab_0" onclick="load_deck('#n5_vocab_0');">n5_vocab_0</a></li>
            <li><a href="#n5_vocab_1" onclick="load_deck('#n5_vocab_1');">n5_vocab_1</a></li>
            <li><a href="#n5_vocab_2" onclick="load_deck('#n5_vocab_2');">n5_vocab_2</a></li>
            <li><a href="#n5_vocab_3" onclick="load_deck('#n5_vocab_3');">n5_vocab_3</a></li>
            <li><a href="#n5_vocab_4" onclick="load_deck('#n5_vocab_4');">n5_vocab_4</a></li>
            <li><a href="#n5_vocab_5" onclick="load_deck('#n5_vocab_5');">n5_vocab_5</a></li>
            <li><a href="#n5_vocab_6" onclick="load_deck('#n5_vocab_6');">n5_vocab_6</a></li>
            <li><a href="#n5_vocab_7" onclick="load_deck('#n5_vocab_7');">n5_vocab_7</a></li>
            <li><a href="#n5_vocab_8" onclick="load_deck('#n5_vocab_8');">n5_vocab_8</a></li>
            <li><a href="#n5_vocab_9" onclick="load_deck('#n5_vocab_9');">n5_vocab_9</a></li>
            <li><a href="#n5_vocab_10" onclick="load_deck('#n5_vocab_10');">n5_vocab_10</a></li>
            <li><a href="#n5_vocab_11" onclick="load_deck('#n5_vocab_11');">n5_vocab_11</a></li>
            <li><a href="#n5_vocab_12" onclick="load_deck('#n5_vocab_12');">n5_vocab_12</a></li>
            <li><a href="#n5_vocab_13" onclick="load_deck('#n5_vocab_13');">n5_vocab_13</a></li>
            <li><a href="#n5_vocab_14" onclick="load_deck('#n5_vocab_14');">n5_vocab_14</a></li>
            <li><a href="#n5_vocab_15" onclick="load_deck('#n5_vocab_15');">n5_vocab_15</a></li>
            <li><a href="#n5_vocab_16" onclick="load_deck('#n5_vocab_16');">n5_vocab_16</a></li>
            <li><a href="#n5_vocab_17" onclick="load_deck('#n5_vocab_17');">n5_vocab_17</a></li>
            <li><a href="#n5_vocab_18" onclick="load_deck('#n5_vocab_18');">n5_vocab_18</a></li>
            <li><a href="#n5_vocab_19" onclick="load_deck('#n5_vocab_19');">n5_vocab_19</a></li>
            <li><a href="#n5_vocab_20" onclick="load_deck('#n5_vocab_20');">n5_vocab_20</a></li>
            <li><a href="#n5_vocab_21" onclick="load_deck('#n5_vocab_21');">n5_vocab_21</a></li>
            <li><a href="#n5_vocab_22" onclick="load_deck('#n5_vocab_22');">n5_vocab_22</a></li>
            <li><a href="#n5_vocab_23" onclick="load_deck('#n5_vocab_23');">n5_vocab_23</a></li>
            <li><a href="#n5_vocab_24" onclick="load_deck('#n5_vocab_24');">n5_vocab_24</a></li>
            <li><a href="#n5_vocab_25" onclick="load_deck('#n5_vocab_25');">n5_vocab_25</a></li>
            <li><a href="#n5_vocab_26" onclick="load_deck('#n5_vocab_26');">n5_vocab_26</a></li>
            <li><a href="#n5_vocab_27" onclick="load_deck('#n5_vocab_27');">n5_vocab_27</a></li>
            <li><a href="#n5_vocab_28" onclick="load_deck('#n5_vocab_28');">n5_vocab_28</a></li>
            <li><a href="#n5_vocab_29" onclick="load_deck('#n5_vocab_29');">n5_vocab_29</a></li>
            <li><a href="#n5_vocab_30" onclick="load_deck('#n5_vocab_30');">n5_vocab_30</a></li>
            <li><a href="#n5_vocab_31" onclick="load_deck('#n5_vocab_31');">n5_vocab_31</a></li>
            <li><a href="#n5_vocab_32" onclick="load_deck('#n5_vocab_32');">n5_vocab_32</a></li>
            <li><a href="#n5_vocab_33" onclick="load_deck('#n5_vocab_33');">n5_vocab_33</a></li>
        </ul>
    </div>
    <script type="text/javascript" src="decks.js"></script>
    <script type="text/javascript">
        const default_answer = "XXXXX";
        const default_question = ["完全"];
        var current_answer_id = "answer";
        var current_answer_value = default_answer;
        var current_question_index = 0;
        var max_question_index = 0;
        var question_set = [];
        var show_hint_setting = false;
        function get_question_choice() {
            return window.location.hash;
        }
        function load_deck(deck_name) {
            if(deck_name in decks) {
                show_q_and_a();
                show_controls();
                hide_links();
                set_questions(deck_name);
            } else {
                hide_q_and_a();
                hide_controls();
                show_links();
            }
        }
        function toggle_hint_setting() {
            let hint_toggle = document.getElementById("hint-toggle");
            show_hint_setting = hint_toggle.checked;
            reset_hint();
        }
        function reset_hint() {
            if (show_hint_setting) {
                show_hint();
            } else {
                hide_hint();
            }
        }
        function hide_hint() {
            let hint = document.getElementById("hint");
            hint.style.display="none";
        }
        function show_hint(){
            let hint = document.getElementById("hint");
            hint.style.display="block";

        }
        function temporarily_show_hide_hint(){
            let hint = document.getElementById("hint");
            if (hint.style.display === "none") {
                hint.style.display="block";
            } else {
                hint.style.display="none";
            }
        }
        function hide_q_and_a() {
            let qanda = document.getElementById("q-and-a");
            qanda.style.display="none";
        }
        function show_q_and_a(){
            let qanda = document.getElementById("q-and-a");
            qanda.style.display="block";

        }
        function hide_controls() {
            let controls = document.getElementById("controls");
            controls.style.display="none";
        }
        function show_controls(){
            let controls = document.getElementById("controls");
            controls.style.display="block";

        }
        function hide_links() {
            let links = document.getElementById("question-sets");
            links.style.display="none";
        }
        function show_links(){
            let links = document.getElementById("question-sets");
            links.style.display="block";

        }
        function answer_id() {
            return "answer-" + Date.now().toString()
        }
        function set_questions(deck_name) {
            let chosen_questions = decks[deck_name];
            question_set = shuffle(chosen_questions);
            max_question_index = chosen_questions.length - 1;
            current_question_index = 0;
            set_question_text(question_set[0]["question"]);
            set_answer(question_set[0]["answer"]);
        }
        function set_question_text(question_info) {
            let question = document.getElementById("question");
            let hint = document.getElementById("hint");
            question.innerHTML = question_info[0];
            hint.innerHTML = "<div>" + question_info.slice(1).join("</div><div>") + "</div>";
            reset_hint();
        }
        function shuffle(array) {
            array.sort(() => Math.random() - 0.5);
            return array
        }
        function set_answer(answer_text) {
            let answer_container = document.getElementById("answer-container");
            let current_answer = document.getElementById(current_answer_id);
            let new_answer_id = answer_id();
            let new_answer = document.createElement("input");
            let fake_input = document.createElement("input");
            new_answer.type="text";
            new_answer.setAttribute("id", new_answer_id);
            new_answer.setAttribute("onkeyup", "check_answer();");
            answer_container.removeChild(current_answer);
            answer_container.appendChild(new_answer);
            current_answer_id = new_answer_id;
            current_answer_value = answer_text;

            // Hack to get iOS to focus on new input.
            fake_input.setAttribute('type', 'text');
            fake_input.style.position = 'absolute';
            fake_input.style.opacity = 0;
            fake_input.style.height = 0;
            document.body.prepend(fake_input);
            fake_input.focus();
            setTimeout(() => {
                new_answer.focus()
                fake_input.remove()
            }, 100)
        }
        function check_answer() {
            let answer = document.getElementById(current_answer_id);
            if (current_answer_value === answer.value) {
                next_question()
            }
        }
        function next_question() {
            current_question_index += 1;
            if (current_question_index <= max_question_index) {
                set_question_text(question_set[current_question_index]["question"]);
                set_answer(question_set[current_question_index]["answer"]);
            } else {
                set_question_text(default_question);
                set_answer(default_answer);
            }
        }
        if(window.location.hash in decks) {
            show_q_and_a();
            show_controls();
            hide_links();
            set_questions(window.location.hash);
        } else {
            hide_q_and_a();
            hide_controls();
            show_links();
        }
    </script>
</body>
</html>
